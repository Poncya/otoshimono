<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>落とし物の詳細 - otoshimono</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-body: #f5f5f5;
      --bg-card: #ffffff;
      --border-subtle: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --primary: #2563eb;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: var(--bg-body);
      color: var(--text-main);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 8px;
    }

    h1 {
      font-size: 1.4rem;
      margin: 0;
    }

    h2 {
      font-size: 1.1rem;
      margin: 0 0 12px 0;
    }

    .card {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
      max-width: 640px;
      margin: 0 auto 16px auto;
      transition: box-shadow 0.15s ease, transform 0.15s ease;
    }

    .card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
    }

    dt {
      font-weight: 600;
      margin-top: 8px;
    }

    dd {
      margin: 0 0 4px 0;
      color: var(--text-main);
    }

    a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.15s ease;
    }

    a:hover {
      text-decoration: underline;
    }

    button {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
    }

    button.primary {
      background: var(--primary);
      color: #ffffff;
      box-shadow: 0 1px 4px rgba(37, 99, 235, 0.3);
    }

    button.primary:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.4);
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      font-size: 0.9rem;
      margin-top: 2px;
    }

    label {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
    }

    textarea {
      min-height: 80px;
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .card {
        padding: 12px;
        border-radius: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>落とし物の詳細</h1>
    <div>
      <a href="/items">一覧へ戻る</a>
      |
      <a href="/mypage">マイページ</a>
    </div>
  </header>

  <section class="card">
    <h2>基本情報</h2>
    <dl>
      <dt>ID</dt>
      <dd><%= item.id %></dd>

      <dt>品名</dt>
      <dd><%= item.name %></dd>

      <dt>拾った場所</dt>
      <dd><%= item.place %></dd>

      <dt>拾った日時</dt>
      <dd>
        <% if (item.pickedAt) { %>
          <%= item.pickedAt.toISOString().slice(0, 16).replace('T', ' ') %>
        <% } else { %>
          -
        <% } %>
      </dd>

      <dt>登録者</dt>
      <dd><%= item.registrant ? item.registrant.email : '-' %></dd>

      <dt>持ち主（確定）</dt>
      <dd><%= item.owner ? item.owner.email : '未確定' %></dd>
    </dl>
  </section>

  <!-- 持ち主申請フォーム -->
  <section class="card">
    <h2>これは私の物です</h2>
    <p>この落とし物の持ち主である場合、連絡先と一言メッセージを送ることができます。</p>

    <form action="/items/claim" method="post">
      <input type="hidden" name="itemId" value="<%= item.id %>" />

      <div>
        <label for="name">氏名</label><br />
        <input type="text" id="name" name="name" required />
      </div>

      <div style="margin-top: 8px;">
        <label for="contact">連絡先（メールアドレスや電話番号など）</label><br />
        <input type="text" id="contact" name="contact" required />
      </div>

      <div style="margin-top: 8px;">
        <label for="message">補足メッセージ（任意）</label><br />
        <textarea id="message" name="message" placeholder="特徴や状況などがあれば書いてください"></textarea>
      </div>

      <div style="margin-top: 12px;">
        <button class="primary" type="submit">申請する</button>
      </div>
    </form>
  </section>

  <!-- 登録者だけが見られる申請一覧 -->
  <% if (typeof currentUserId !== 'undefined' && currentUserId === item.subsid) { %>
    <section class="card">
      <h2>この落とし物への申請一覧（登録者のみ表示）</h2>

      <% if (!item.claims || item.claims.length === 0) { %>
        <p>まだ申請はありません。</p>
      <% } else { %>
        <ul>
          <% item.claims.forEach(function(claim) { %>
            <li style="margin-bottom: 8px;">
              <div>
                <strong><%= claim.name %></strong>
                （<%= claim.contact %>）
              </div>
              <div>
                申請者アカウント: <%= claim.applicant ? claim.applicant.email : '-' %>
              </div>
              <div>
                申請日時:
                <%= claim.createdAt.toISOString().slice(0, 16).replace('T', ' ') %>
              </div>
              <% if (claim.message) { %>
                <div>メッセージ: <%= claim.message %></div>
              <% } %>
            </li>
          <% }); %>
        </ul>
      <% } %>
    </section>
  <% } %>
</body>
</html>
